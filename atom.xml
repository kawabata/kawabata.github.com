<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[A Riddle Wrapped in a Mystery]]></title>
  <link href="http://kawabata.github.com/atom.xml" rel="self"/>
  <link href="http://kawabata.github.com/"/>
  <updated>2013-03-12T01:33:49+09:00</updated>
  <id>http://kawabata.github.com/</id>
  <author>
    <name><![CDATA[dotabata]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Lookup で オフラインWikipedia を閲覧する]]></title>
    <link href="http://kawabata.github.com/blog/2013/03/10/ndzim/"/>
    <updated>2013-03-10T23:00:00+09:00</updated>
    <id>http://kawabata.github.com/blog/2013/03/10/ndzim</id>
    <content type="html"><![CDATA[<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">Lookup の ndzim エージェント</h2>
<div class="outline-text-2" id="text-1">
<p>
最近、<a href="http://lookup2.github.com/">Lookup</a> で <a href="http://openzim.org">OpenZIM</a> 形式のファイルを検索するための <code>ndzim</code> エージェン
トを試作した。
</p>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">OpenZIM について</h2>
<div class="outline-text-2" id="text-2">
<p>
<a href="http://openzim.org">OpenZIM</a> ファイル形式は、多数のWebページやそれに付随する画像データを、圧
縮して１ファイルにまとめる。主に Wikipedia 等の MediaWiki の記事をアー
カイブするために開発されている。Wikipedia 財団が公認している。
</p>

<p>
OpenZIM の<a href="http://www.openzim.org/wiki/ZIM_file_format">内部構造</a> は、LZMA2で圧縮された多数のデータの集合体である。日
本語版Wikipediaの全記事（2011年現在）を画像込みで 7GByte、英語版
Wikipediaを画像なしで 12GByte 程度に圧縮できる。様々な言語のWikipeida 全
記事をアーカイブした OpenZIMファイルがKiwixサイトにて<a href="http://www.kiwix.org/wiki/Wikipedia_in_all_languages">配布</a>されている。
</p>
</div>
</div>
<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">ZimLibのインストール</h2>
<div class="outline-text-2" id="text-3">
<p>
Lookup の ndzim エージェントは、<a href="https://gerrit.wikimedia.org/r/p/openzim.git">zimlib</a> に付属するzimdump/zimsearch ツー
ルでOpenZIMファイルの検索とデータのダンプを行い、w3mで整形する。
</p>

<p>
zimlib のコンパイルには lzma ライブラリが別途必要。MacPorts等でlzmaラ
イブラリをインストールする場合は、CPPFLAGSやLDFLAGS環境変数を適切に設
定する。 
</p>

<pre class="example">
% git clone https://gerrit.wikimedia.org/r/p/openzim.git
% cd cd openzim/zimlib
% ./autogen.sh
% ./configure
% make
% sudo make install
</pre>
</div>
</div>
<div id="outline-container-4" class="outline-2">
<h2 id="sec-4">Lookup の設定</h2>
<div class="outline-text-2" id="text-4">
<p>
Lookup で OpenZIMを使うためには、 <code>$HOME/.emacs.d/lookup/init.el</code> に、
ZIMファイルを入れたディレクトリを検索エージェントとして設定する。
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq lookup-search-agents
      '(...
        (ndzim <span style="color: #ffa07a;">"/path/to/dir"</span>)
       ))
</pre>
</div>

<p>
上記のように設定すると、検索エージェントは <code>/path/to/dir</code> ディレクトリ
内にある、拡張子が <code>.zim</code> のファイルを見つける。
</p>

<p>
あとは他のエージェントと同様、 <code>M-x lookup-restart</code> にて、無事に辞書選
択バッファに辞書が表示されたら、単語で検索して動作を確認。
</p>


<div class="figure">
<p><img src="http://kawabata.github.com/images/2013-03-10-ndzim.png"  alt="2013-03-10-ndzim.png"/></p>
<p>検索サンプル</p>
</div>
</div>
</div>
]]></content>
  </entry>
  
</feed>
